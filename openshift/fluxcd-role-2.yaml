---
###  this is a prototype role and role binding to attempt to remove the requirement that we run the following work arounds to deploy the test app in openshift
# kubectl create clusterrolebinding dev-space --clusterrole=cluster-admin --serviceaccount=dev-space:default
# kubectl delete clusterrolebinding dev-space
# latest role and rolebinding to get pat, but now i'm getting this error
#$ tanzu apps workload get tanzu-java-web-app -n dev-space
#  tanzu-java-web-app: Unknown
#---
#lastTransitionTime: "2022-05-28T14:42:41Z"
#message: waiting to read value [.status.outputs.url] from resource [runnable.carto.run/tanzu-java-web-app]
#  in namespace [dev-space]
#reason: MissingValueAtPath
#status: Unknown
#type: Ready
#
#  Pods
#  NAME                                STATUS   RESTARTS   AGE
#
# try to delete and re-create dev-space and apply these roles and role-binding before deploying fluxcd
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: fluxcd-role-2
  namespace: dev-space
rules:
  - apiGroups:
      - fluxcd.io
    resources:
      - finalizers
    verbs:
      - '*'
  - apiGroups:
      - source.toolkit.fluxcd.io
    resources:
      - gitrepositories
      - gitrepositories/finalizers
    verbs:
      - '*'
  - apiGroups:
      - scanning.apps.tanzu.vmware.com
    resources:
      - imagescans
      - imagescans/finalizers
      - scanpolicies
      - scanpolicies/finalizers
      - scantemplates
      - scantemplates/finalizers
      - sourcescans
      - sourcescans/finalizers
    verbs:
      - '*'
  - apiGroups:
      - carto.run
    resources:
      - clusterconfigtemplates
      - clusterconfigtemplates/finalizers
      - clusterdeliveries
      - clusterdeliveries/finalizers
      - clusterdeploymenttemplates
      - clusterdeploymenttemplates/finalizers
      - clusterimagetemplates
      - clusterimagetemplates/finalizers
      - clusterruntemplates
      - clusterruntemplates/finalizers
      - clustersourcetemplates
      - clustersourcetemplates/finalizers
      - clustersupplychains
      - clustersupplychains/finalizers
      - clustertemplates
      - clustertemplates/finalizers
      - deliverables
      - deliverables/finalizers
      - runnables
      - runnables/finalizers
      - workloads
      - workloads/finalizers
    verbs:
      - '*'
#  clusterconfigtemplates                cct                                    carto.run/v1alpha1                                                  false        ClusterConfigTemplate
#  clusterdeliveries                     cd                                     carto.run/v1alpha1                                                  false        ClusterDelivery
#  clusterdeploymenttemplates            cdt                                    carto.run/v1alpha1                                                  false        ClusterDeploymentTemplate
#  clusterimagetemplates                 cit                                    carto.run/v1alpha1                                                  false        ClusterImageTemplate
#  clusterruntemplates                   crt                                    carto.run/v1alpha1                                                  false        ClusterRunTemplate
#  clustersourcetemplates                cst                                    carto.run/v1alpha1                                                  false        ClusterSourceTemplate
#  clustersupplychains                   csc                                    carto.run/v1alpha1                                                  false        ClusterSupplyChain
#  clustertemplates                      ct                                     carto.run/v1alpha1                                                  false        ClusterTemplate
#  deliverables                          dlv                                    carto.run/v1alpha1                                                  true         Deliverable
#  runnables                             run                                    carto.run/v1alpha1                                                  true         Runnable
#  workloads                             wld                                    carto.run/v1alpha1                                                  true         Workload
#fluxcd.io
#carto.run
#ClusterSourceTemplate

###
#  imagescans                                                                   scanning.apps.tanzu.vmware.com/v1beta1                              true         ImageScan
#  scanpolicies                                                                 scanning.apps.tanzu.vmware.com/v1beta1                              true         ScanPolicy
#  scantemplates                                                                scanning.apps.tanzu.vmware.com/v1beta1                              true         ScanTemplate
#  sourcescans                                                                  scanning.apps.tanzu.vmware.com/v1beta1                              true         SourceScan
###
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: fluxcd-role-binding-2
  namespace: dev-space
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: fluxcd-role-2
subjects:
  - kind: ServiceAccount
    name: default
    namespace: dev-space
